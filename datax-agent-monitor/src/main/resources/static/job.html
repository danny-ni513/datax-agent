<!DOCTYPE html>
<html>
<head>
    <title>DATAX-AGENT-MONITOR-JOB</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="sockjs.min.js"></script>
    <script src="stomp.min.js"></script>
    <script src="utils.js" ></script>
    <script src="ws.js?_t=09280009"></script>
</head>
<body>
<div id="main-content" class="container" style="margin-top: 10px;">
    <div class="row">
        <div class="col-md-12">
            <h5 class="page-header" style="font-weight:bold" id="nowStatusLab"></h5>
            <table class="table table-striped">
                <tbody id="information" style="table-layout: fixed;height: 800px;display: block;overflow-y: scroll;"></tbody>
            </table>
        </div>
    </div>
</div>
</body>
<script>
    var jobId = getUrlParam("id")
    var msgLock = true;
    $("#nowStatusLab").html("开始连接服务器");
    connect(function(){
        $("#nowStatusLab").html("已连接服务器");
        var msgArray = new Array();
        $.get("",function(resp){
            var dataList = resp.data;
            dataList.forEach(data,function(){
                $("#information").append("<tr><td>" + data + "</td></tr>");
                document.getElementById("information").scrollTop = document.getElementById("information").scrollHeight;
            })
            for (let i = 0; i < msgArray.length; ++i) {
                let data = msgArray.pop();
                $("#information").append("<tr><td>" + data + "</td></tr>");
                document.getElementById("information").scrollTop = document.getElementById("information").scrollHeight;
            }
            msgLock=false;
        })

        subscribeJob(jobId,function(msg){
            if(msgLock){
                msgArray.push(msg)
            }else{
                $("#information").append("<tr><td>" + msg + "</td></tr>");
                document.getElementById("information").scrollTop = document.getElementById("information").scrollHeight;
            }
        })

    })
</script>
</html>