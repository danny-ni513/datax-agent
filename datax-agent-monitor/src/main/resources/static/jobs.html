<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jobList</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="jquery-3.5.1.min.js"></script>
    <script src="sockjs.min.js"></script>
    <script src="stomp.min.js"></script>
    <script src="ws.js?_t=09280009"></script>
</head>
<body>
<div id="main-content" class="container" style="margin-top: 10px;">
    <div class="row">
        <form class="navbar-form" style="margin-left:0px">
            <div class="col-md-12">
                <div class="form-group">
                    <label>操作：</label>
                    <button class="btn btn-primary" type="button" >添加任务</button>
                </div>
            </div>
        </form>
    </div>
    </br>
    <div class="row">
        <div class="col-md-12">
            <h5 class="page-header" style="font-weight:bold" id="nowStatusLab"></h5>
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">任务ID</th>
                <th scope="col">更新时间</th>
                <th scope="col">状态</th>
                <th scope="col">操作</th>
            </tr>
            </thead>
            <table class="table table-striped">
                <tbody id="jobList">

                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
<script>
    $("#nowStatusLab").html("开始连接服务器");
connect(function() {
    $("#nowStatusLab").html("已连接服务器");
    //TODO 进行初始化，加载所有JOB
    var rowNum = 1;
    $.get("/jobs",function(resp){
        var dataList = resp.data;
        var optInfo="";
        var lastTime = "";//data.lastTime
        dataList.forEach(data,function(){
            $("#jobList").append("<tr><td>"+rowNum+"</td><td><a href='job.html?id="+data.jobId+"'>"+data.jobName+"</a></td><td id='lastTime_"+data.jobId+"'>"+lastTime+"</td><td id='status_"+data.jobId+"'>"+data.status+"</td><td>"+optInfo+"</td></tr>");
            rowNum=rowNum+1;
        })
    })
    subscribeAllJob(function (jobSummary) {
        $("#lastTime_"+jobSummary.jobId).html(jobSummary.lastTime);
        $("#status_"+jobSummary.jobId).html(jobSummary.status);

    })
});

</script>
</html>